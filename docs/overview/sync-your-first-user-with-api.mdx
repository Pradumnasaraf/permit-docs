---
sidebar_position: 2
title: Sync your First User using the API
timeline: true
---

Syncing a user is one of the most integral parts of using Permit, as it serves as the handoff point
between your application's user management system and our policy engine.

:::tip
Permit is fully API-driven, providing a seamless way to programmatically manage everything you can do via our
no-code UI.
:::

> In this guide, we’ll show you how to sync your first user into Permit using the API, ensuring they’re ready to be
> assigned roles and permissions within your access control model.

## timeline-start

## Our API Reference

Explore the complete API documentation at using our [Redoc](https://api.permit.io/v2/redoc) to dive into all available
endpoints and their usage.

In this guide we will be making use of two separate endpoint in our API:

1. [Creating a user](https://api.permit.io/v2/redoc#tag/Users/operation/create_user)
2. [Assigning a role to a user](https://api.permit.io/v2/redoc#tag/Users/operation/assign_role_to_user)

## Obtain your API key

To start using Permit.io, you’ll need an API key to authenticate your application with the Permit platform. This key is
essential for accessing Permit’s authorization services and managing your app's permissions.

1. Open the [Permit Dashboard](https://app.permit.io/) and go to the **Projects** screen.
2. Select the desired [Project](/overview/glossary#projects) and [Environment](/overview/glossary#environment).
3. On the environment card, click the ![three dots icon](/ui-videos/getting-started/connecting-your-app/dots.png) in the
   top-right corner.
4. Choose **Copy API Key** from the dropdown menu.

<img
  src="/img/updated/quickstart/sdk-key-1.png"
  alt="Copy secret key from user menu"
  data-zoomable
/>

:::tip TOP TIP
You can also copy the Environment API Key of the active environment by clicking on the **User Menu Icon > Copy Environment
Key**

<img
  src="/img/updated/quickstart/sdk-key-2.png"
  alt="Copy secret key from Projects management"
  data-zoomable
/>
:::

:::info Remember
The API Key that you will copy from the user menu is linked to the active environment on the sidebar.
Switching to another active environment and then clicking on the **Copy Environment Key** option will copy a **different**
API Key - the API key of the newly activated environment.
:::

## Understand the User Data model

To effectively sync a user using the Permit API, it’s important to understand both the user data structure and the hierarchy
of Permit’s system, as well as the required parameters for API calls.

In Permit, the hierarchy begins with an Account—this is your Permit account, and it can include one or more **Workspaces**.
A Workspace typically represents a company or organization. For example, if you’re working across multiple companies or
divisions, you can belong to and manage multiple workspaces within the same account.

Each workspace can contain multiple **Projects**, which often represent specific external applications, services, or
initiatives. Projects are further divided into **Environments**, such as Production, Staging, or Development. This
flexible structure allows you to map Permit to your organization’s unique requirements, acting as a scalable set of
building blocks.

We defined the above, because when making most API calls, the following parameters are required:

- **Environment ID (env_id)**: Specifies the environment (e.g., Production, Staging) for the operation.
- **Project ID (proj_id)**: Identifies the project within the workspace.
- **User Key/ID**: A unique identifier for the user being synced, such as an email address or a system-specific user ID.

Every API endpoint requires these parameters to ensure the request is correctly scoped to the desired workspace, project,
and environment.

## Getting the project id

To retrieve the project ID, click on the three dots and the key will be visible in the pop-up.

![Getting Project ID](/ui-videos/project-and-env/project-id.png)

## Getting the environment id

To retrieve the environment ID, click on the three dots and the key will be visible in the pop-up.

![Get env id](/ui-videos/workspace-settings/getting-env-id.png)

## Make a User Sync API request

To create a user in Permit, you need to make a POST request to the users endpoint using your project ID (`proj_id`),
environment ID (`env_id`), and the user's unique details. This ensures the user is properly synced into the specified environment
and ready for role assignments.

```js title="https://api.permit.io/v2/facts/${projId}/${envId}/users"
const axios = require("axios");

async function createUser(projId, envId, userData, token) {
  const url = `https://api.permit.io/v2/facts/${projId}/${envId}/users`;

  const headers = {
    Authorization: `Bearer ${token}`,
    "Content-Type": "application/json",
  };

  try {
    const response = await axios.post(url, userData, { headers });
    console.log("User created successfully:", response.data);
  } catch (error) {
    if (error.response) {
      console.error("Error response:", error.response.data);
    } else {
      console.error("Error:", error.message);
    }
  }
}

// Example usage
const projId = "your_project_id";
const envId = "your_env_id";
const token = "your_bearer_token"; // Replace with your actual token
const userData = {
  key: "user|123456789",
  email: "john@smith.com",
  first_name: "John",
  last_name: "Smith",
};

createUser(projId, envId, userData, token);
```

## Verify the user was created in the Permit Directory

> In this case, I will use postman to run this request:

<img
  src="/img/updated/walkthroughs/api-request-no-role.png"
  alt="Using postman to send API request"
  data-zoomable
/>

> And here is the result in the UI, under the `Directory`:

<img
  src="/img/updated/walkthroughs/api-request-success.png"
  alt="Copy secret key from user menu"
  data-zoomable
/>

As part of the POST request, or in this example the `userData` object, you can directly assign roles to the user upon creation. Simply include the `role_assignments`
field in the request body, such as:

```js
role_assignments: [{ role: "manager", tenant: "default" }];
```

This allows you to streamline the user creation process by immediately associating them with the appropriate role and into the
right tenant.

> Below is the request in Postman for **adding a user with a role assignment**:

<img
  src="/img/updated/walkthroughs/api-request-role.png"
  alt="Copy secret key from user menu"
  data-zoomable
/>

> And therefore the result of this request in the Permit `directory`:

<img
  src="/img/updated/walkthroughs/api-request-success-2.png"
  alt="Copy secret key from user menu"
  data-zoomable
/>

## Assign a role to the User (optional)

Once the user is created, you can choose to make another API request to `assign a role to the user`. This is done by calling the
following endpoint.

```js title="https://api.permit.io/v2/facts/{proj_id}/{env_id}/users/{user_id}/roles"
const axios = require("axios");

async function assignRole(projId, envId, userId, roleData, token) {
  const url = `https://api.permit.io/v2/facts/${projId}/${envId}/users/${userId}/roles`;

  const headers = {
    Authorization: `Bearer ${token}`,
    "Content-Type": "application/json",
  };

  try {
    const response = await axios.post(url, roleData, { headers });
    console.log("Role assigned successfully:", response.data);
  } catch (error) {
    if (error.response) {
      console.error("Error response:", error.response.data);
    } else {
      console.error("Error:", error.message);
    }
  }
}

// Example usage
const projId = "your_project_id";
const envId = "your_env_id";
const userId = "your_user_id";
const token = "your_bearer_token";
const roleData = {
  role: "admin",
  tenant: "default",
};

assignRole(projId, envId, userId, roleData, token);
```

## timeline-stop

## What did you learn?

In this guide, you’ve learned how to:

- Sync a user into Permit using the API.
- Assign roles to a user either during creation or later through a dedicated API call.
- Understand Permit’s hierarchy (workspaces, projects, environments) and how it relates to API calls.

:::tip FUN FACT!
Ever heard of the Cat Facts API? Developers created it as a joke, but it became a hit for testing API integrations while
sending random cat facts.
:::

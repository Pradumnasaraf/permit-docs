---
sidebar_position: 1
title: to Production
description: "How to deploy the Permit PDP to Prod"
---

When deploying to production, you might want to work with a local PDP (A Policy-Decision-Point microservice) within your VPC.
The PDP is easy to install via Docker, and will ensure **zero-latency, great performance, high availability, and improved security**.
Like all Permit customer deployed components, the [Permit PDP is open-source](https://github.com/permitio/PDP).

## Architecture diagram

<br />
<br />

![Connectivity Map Diagram](/img/diagrams/connectivity.svg)

## Installing the PDP

Pull our PDP container from Docker Hub [(Click here to install Docker)](https://docs.docker.com/get-docker/):

```sh
docker pull permitio/pdp-v2:latest
```

Run the container & replace the `PDP_API_KEY` environment variable with your API key.

```sh
docker run -it \
  -p 7766:7000 \
  --env PDP_API_KEY=<YOUR_API_KEY> \
  --env PDP_DEBUG=True \
  permitio/pdp-v2:latest
```

## Using the PDP

The PDP will listen on port `7766` by default, so all you have to do is to set your PDP_URL in our SDK initialization to
`http://localhost:7766` and you're good to go.

For example in Node.js:

```js
const permit = new Permit({
  pdp: "http://localhost:7766",
  token: "<YOUR_API_KEY>",
});
```

## Exposing OPA within the PDP

Similar to a regular run of the PDP, with the addition of a single port mapping (`-p 8181:8181`)
Run the container & replace the `PDP_API_KEY` environment variable with your API key.

```sh
docker run -it \
  -p 7766:7000 \
  -p 8181:8181 \
  --env PDP_API_KEY=<YOUR_API_KEY> \
  --env PDP_DEBUG=True \
  permitio/pdp-v2:latest
```

Reviews [OPA's docs here for accessing its API](https://www.openpolicyagent.org/docs/latest/rest-api/).

## System Requirements and Performance Optimization

When deploying your PDP in production, consider the following system requirements and performance tips to ensure optimal operation:

### Where to start

CPU & memory requirements would obviously deeply depend on the scale of your application, but here are some good values to start with:

- CPU: ~200 mcores. but enable upper limit of at least ~1000 mcores to enable short CPU spikes and keep the PDP responsive
- Memory: ~512Mb

### Scaling CPU

Processing demands of PDP would depend on the number of requests it has to handle, as well as the complexity of the queried policies.
When CPU usage becomes a bottleneck, you can scale the PDP horizontally by deploying multiple instances behind a load balancer (e.g. scale replicas of Kubernetes deployment),
thus distributing the load and increasing the number of requests the PDP can handle.

### Scaling Memory

Memory usage of the PDP would depend on the volume of data in your environment.
PDP makes use of OPA to achieve very fast policy evaluation, this speed of evaluation is achieved by:

- Storing the environment's policy data in its entirety in local process's memory.
- Using redundant data structures and caches.
  This means that scaling of your environment's policy data requires vertical scaling of the PDP's memory.
  And while exact requirements would depend on many factors (e.g. what attributes your objects have, complexity of relations between objects when ReBAC is used),
  we can suggest using the formula of _`# of policy objects X 6kb`_ (where policy objects include: users, resource instances & tenants) as a rough estimate.
  For example: For environment of 100k users, 500k resource instances and 100 tenants, you'll need ~3.5Gb of memory.

For multi-tenant environments, data / memory can be scaled horizontally by using [tenant based sharding](/how-to/manage-data/pdp-sharding).

### General Performance Tips

To achieve high throughput and low latency:

- **Use a Local PDP**: Deploy the PDP in the same VPC as your application to minimize network latency.
- **Disable Decision Debug Info**: In production, you can turn off decision debug information to enhance performance. Disable debug logging by adding `--env PDP_DEBUG=False` to the PDP command line.
- **Optimize Base Policy**: Tailor the base policy to your specific use case. For example, disabling ReBAC checks (if not used) can speed up policy execution (this requires our tech support).
  With these optimizations, you can expect several thousand RPS with less than 10ms latency per request.
